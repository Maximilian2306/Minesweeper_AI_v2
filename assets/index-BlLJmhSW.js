(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();const K=document.getElementById("timer");function W(a){a.startTime||(a.startTime=Date.now());const e=Date.now(),i=Math.floor((e-a.startTime)/1e3),t=Math.floor(i/60).toString().padStart(2,"0"),s=(i%60).toString().padStart(2,"0");K.textContent=`${t}:${s}`}class ${constructor(e,i){this.boardSize=e,this.mineCount=i,this.board=[],this.gameOver=!1,this.startTime=null,this.timerInterval=null,this.kiRunning=!1,this.kiTimeout=null}init(){this.board=[],this.gameOver=!1,this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.startTime=null,this.generateBoard(),this.placeMines(),this.calculateNumbers()}generateBoard(){for(let e=0;e<this.boardSize;e++){this.board[e]=[];for(let i=0;i<this.boardSize;i++)this.board[e][i]={x:i,y:e,mine:!1,revealed:!1,flagged:!1,number:0}}}placeMines(){let e=0;for(;e<this.mineCount;){const i=Math.floor(Math.random()*this.boardSize),t=Math.floor(Math.random()*this.boardSize),s=this.board[t][i];s.mine||(s.mine=!0,e++)}}calculateNumbers(){for(let e=0;e<this.boardSize;e++)for(let i=0;i<this.boardSize;i++){const t=this.board[e][i];t.mine||(t.number=this.countNeighborMines(i,e))}}countNeighborMines(e,i){let t=0;for(let s=-1;s<=1;s++)for(let n=-1;n<=1;n++){if(n===0&&s===0)continue;const o=e+n,l=i+s;o>=0&&o<this.boardSize&&l>=0&&l<this.boardSize&&this.board[l][o].mine&&t++}return t}revealCell(e,i){if(this.gameOver)return{changed:[],result:"ignore"};const t=this.board[i][e];if(t.revealed||t.flagged)return{changed:[],result:"ignore"};const s=[],n=(o,l)=>{const d=[[o,l]],h=new Set;for(;d.length>0;){const[c,r]=d.pop(),y=`${c},${r}`;if(h.has(y))continue;h.add(y);const x=this.board[r][c];if(!x.revealed&&(x.revealed=!0,s.push({x:c,y:r}),x.number===0&&!x.mine))for(let E=-1;E<=1;E++)for(let I=-1;I<=1;I++){const v=c+I,C=r+E;v>=0&&v<this.boardSize&&C>=0&&C<this.boardSize&&d.push([v,C])}}};return t.mine?this.kiRunning?(this.gameOver=!0,{changed:s,result:"ki"}):(this.gameOver=!0,this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),{changed:[{x:e,y:i}],result:"lose"}):(n(e,i),this.checkWin()?(this.kiRunning&&(this.kiRunning=!1),this.gameOver=!0,this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),{changed:s,result:"win"}):{changed:s,result:"ok"})}toggleFlag(e,i){if(this.gameOver)return;const t=this.board[i][e];if(!t.revealed)return t.flagged=!t.flagged,{x:e,y:i}}checkWin(){return this.board.every(e=>e.every(i=>i.mine||i.revealed))}getCell(e,i){return this.board[i][e]}startTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.startTime=Date.now(),this.timerInterval=setInterval(()=>W(this),1e3)}resetGameState(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.startTime=null,this.kiRunning=!1,this.kiTimeout&&(clearTimeout(this.kiTimeout),this.kiTimeout=null),this.gameOver=!0}}let B=null;function f(a){const e=document.getElementById(a);e&&(e.style.display="none",document.body.classList.remove("popup-open"),B===a&&(B=null))}function w(a,e,i){const t=document.getElementById(a);t&&(t.style.display=e||"block",i&&document.body.classList.add("popup-open"),B=a)}function X(){document.addEventListener("click",a=>{if(a.target.classList.contains("popup")&&B){if(B==="arcade-view"){const e=document.getElementById("pong-canvas");if(e&&e.style.display!=="none")return}f(B)}})}class O{constructor(e,i,t){this.game=e,this.element=i,this.leaderboard=t}renderBoard(){this.element.innerHTML="",this.element.style.gridTemplateColumns=`repeat(${this.game.boardSize}, 30px)`,this.element.style.gridTemplateRows=`repeat(${this.game.boardSize}, 30px)`;for(let e=0;e<this.game.boardSize;e++)for(let i=0;i<this.game.boardSize;i++){const t=document.createElement("div");t.classList.add("cell"),t.dataset.x=i,t.dataset.y=e,t.addEventListener("click",()=>this.onLeftClick(i,e)),t.addEventListener("contextmenu",s=>{s.preventDefault(),this.onRightClick(i,e)}),this.element.appendChild(t)}}onLeftClick(e,i){this.game.startTime||this.game.startTimer();const t=this.game.revealCell(e,i);if(t.changed.forEach(({x:s,y:n})=>this.updateCell(s,n)),t.result==="ki"&&(this.revealAllMinesUI(),this.updateBoard()),t.result==="lose"&&(this.revealAllMinesUI(),w("game-over","flex",!0)),t.result==="win"){this.revealAllMinesUI();const s=Date.now(),n=Math.floor((s-this.game.startTime)/1e3);w("game-win","flex",!0);try{this.leaderboard.saveWinToLeaderboard(n)}catch(o){console.error("Failed to save in leaderboard:",o)}}}onRightClick(e,i){this.game.startTime||this.game.startTimer(),this.game.toggleFlag(e,i),this.updateCell(e,i)}updateBoard(){for(let e=0;e<this.game.boardSize;e++)for(let i=0;i<this.game.boardSize;i++)this.updateCell(i,e)}updateCell(e,i){const t=this.game.getCell(e,i),s=i*this.game.boardSize+e,n=this.element.children[s];n.classList.toggle("revealed",t.revealed),n.classList.toggle("mine",t.revealed&&t.mine),n.classList.toggle("flagged",t.flagged&&!t.revealed),t.revealed&&t.number>0&&!t.mine?n.dataset.number=t.number:delete n.dataset.number,n.textContent="",t.revealed&&t.number>0&&!t.mine&&(n.textContent=t.number)}revealAllMinesUI(){for(let e=0;e<this.game.boardSize;e++)for(let i=0;i<this.game.boardSize;i++){const t=this.game.getCell(i,e);t.mine&&(t.revealed=!0,this.updateCell(i,e))}}}const q=document.getElementById("stopKI"),_=document.getElementById("startRandomKI"),j=document.getElementById("startRuleKI");document.getElementById("header-container");const V=document.getElementById("gameIterations");let m=.1,z=0;function J(a){m=a}function Y(){z++,F()}function A(){z=0,F()}function F(){V.textContent=z}function L(a){a&&(a.kiRunning=!1,console.log("Anzahl der Spiele: "+z),f("stopKI"),f("kiMenu"))}function Q({onStartRandom:a,onStartRule:e,onStop:i}){_.addEventListener("click",a),j.addEventListener("click",e),q.addEventListener("click",i)}function Z({onRestart:a,onModeChange:e}){const i=document.getElementById("restart-btn"),t=document.getElementById("start-btn"),s=document.querySelectorAll(".mode-btn"),n=document.getElementById("kiActBtn"),o=document.getElementById("kiMenu"),l=document.getElementById("game-board"),d=document.getElementById("mine-count"),h=document.getElementById("timer"),c=document.getElementById("custom-size"),r=document.getElementById("custom-mines"),y=document.getElementById("start-custom-game-btn"),x=document.getElementById("cancel-custom-game-btn"),E=document.getElementById("mineIconButton");let I=0;const v=document.getElementById("kiSpeed"),C=document.getElementById("kiSpeedValue");i.addEventListener("click",()=>{h.textContent="00:00",A(),a()}),t.addEventListener("click",()=>{w("mode-popup","flex",!0)}),s.forEach(u=>{u.addEventListener("click",()=>{const p=parseInt(u.getAttribute("data-size"),10),T=parseInt(u.getAttribute("data-mines"),10);if(isNaN(p)||isNaN(T)){w("custom-game-popup","flex",!0),f("mode-popup");return}l.style.gridTemplateColumns=`repeat(${p}, 30px)`,l.style.gridTemplateRows=`repeat(${p}, 30px)`,A(),e({size:p,mines:T}),f("mode-popup"),h.textContent="00:00",d.textContent=`${T}`})}),y.addEventListener("click",()=>{const u=parseInt(c.value,10),p=parseInt(r.value,10);u>0&&u<101&&p>0&&u*u>p&&(l.style.gridTemplateColumns=`repeat(${u}, 30px)`,l.style.gridTemplateRows=`repeat(${u}, 30px)`,A(),e({size:u,mines:p}),f("custom-game-popup"),h.textContent="00:00",d.textContent=`${p}`)}),x.addEventListener("click",()=>{f("custom-game-popup")}),E.addEventListener("click",()=>{const u=["/assets/Pictures/Bomb1.jpeg","/assets/Pictures/Bomb.jpg","/assets/Pictures/Bomb2.jpg","/assets/Pictures/Bomb3.webp"];I=(I+1)%u.length;const p=document.getElementById("mineIconImg");p.src=u[I]}),n.addEventListener("click",()=>{if(getComputedStyle(o).display==="none"){n.textContent="üß† KI deaktivieren";const p=n.getBoundingClientRect();o.style.left=`${p.left}px`,o.style.top=`${p.bottom+window.scrollY}px`,w("kiMenu","block",!1)}else f("kiMenu"),n.textContent="üß† KI aktivieren"}),v.addEventListener("input",()=>{const u=parseFloat(v.value);console.log(`KI-Geschwindigkeit ge√§ndert: ${u}s`),J(u),C.textContent=u.toFixed(2)+"s"})}function ee(a){const e=Math.floor(a/60).toString().padStart(2,"0"),i=(a%60).toString().padStart(2,"0");return`${e}:${i}`}function S(a){return new Promise(e=>setTimeout(e,a))}function b(a,e,i){const t=[];for(let s=-1;s<=1;s++)for(let n=-1;n<=1;n++){if(s===0&&n===0)continue;const o=a+s,l=e+n;if(o>=0&&o<i.boardSize&&l>=0&&l<i.boardSize){const d=i.board[l][o];t.push({...d,x:o,y:l})}}return t}const te=document.getElementById("stopKI"),ie=document.getElementById("kiMenu");class se{constructor(e,i){this.game=e,this.boardUI=i}async run(){if(this.game.gameOver||this.game.kiRunning)return;this.game.kiRunning=!0,console.log("Aktueller Speed: "+m),ie.style.display="none",te.style.display="inline-block";let e=[];for(let t=0;t<this.game.boardSize;t++)for(let s=0;s<this.game.boardSize;s++){const n=this.game.board[t][s];!n.revealed&&!n.flagged&&e.push({x:s,y:t})}for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}let i=0;for(;this.game.kiRunning&&i<e.length;){if(m>0&&await S(m),this.game.gameOver){Y(),this.game.init(),await S(0),e=[];for(let s=0;s<this.game.boardSize;s++)for(let n=0;n<this.game.boardSize;n++){const o=this.game.board[s][n];!o.revealed&&!o.flagged&&e.push({x:n,y:s})}for(let s=e.length-1;s>0;s--){const n=Math.floor(Math.random()*(s+1));[e[s],e[n]]=[e[n],e[s]]}i=0;continue}const t=e[i++];this.boardUI.onLeftClick(t.x,t.y)}}}function ne(a,e){new se(a,e).run()}const G=document.getElementById("stopKI"),ae=document.getElementById("kiMenu");class oe{constructor(e,i){this.game=e,this.boardUI=i}async run(){if(!(this.game.gameOver||this.game.kiRunning))for(console.log("Aktueller Speed: "+m),ae.style.display="none",G.style.display="inline-block",this.game.kiRunning=!0;this.game.kiRunning;){if(m>0&&await S(m),this.game.gameOver){Y(),this.game.init(),await S(0);continue}let e=!1;if(e=await this.applyBasicRules(),e||(e=await this.check1_1Pattern()),e||(e=await this.check1_2_1Pattern()),e||(e=await this.checkAdvancedPatterns()),!e){const i=await this.findSafeGuess();if(i)this.boardUI.onLeftClick(i.x,i.y),e=!0;else{const t=await this.pickBestUnrevealed();if(t)this.boardUI.onLeftClick(t.x,t.y),e=!0;else{this.game.kiRunning=!1,G.style.display="none";break}}}}}async applyBasicRules(){let e=!1;for(let i=0;i<this.game.boardSize;i++)for(let t=0;t<this.game.boardSize;t++){const s=this.game.board[i][t];if(!s.revealed||s.number===0)continue;const n=b(t,i,this.game),o=n.filter(d=>d.flagged).length,l=n.filter(d=>!d.revealed&&!d.flagged);if(o===s.number&&l.length>0){for(const d of l)this.boardUI.onLeftClick(d.x,d.y),e=!0,m>0&&await S(m);continue}if(l.length>0&&l.length===s.number-o)for(const d of l)d.flagged||(this.boardUI.onRightClick(d.x,d.y),e=!0,m>0&&await S(m))}return e}async check1_1Pattern(){let e=!1;for(let i=0;i<this.game.boardSize;i++)for(let t=0;t<this.game.boardSize;t++){const s=this.game.board[i][t];if(!s.revealed||s.number!==1)continue;const n=b(t,i,this.game),o=n.filter(l=>!l.revealed&&!l.flagged);if(o.length===2){for(const l of n)if(l.revealed&&l.number===1){const h=b(l.x,l.y,this.game).filter(c=>!c.revealed&&!c.flagged);if(h.length===2){const c=o.find(r=>h.includes(r));if(c){const r=o.find(y=>y!==c)||h.find(y=>y!==c);if(r&&!r.flagged)return this.boardUI.onLeftClick(r.x,r.y),e=!0,m>0&&await S(m),e}}}}}return e}async check1_2_1Pattern(){let e=!1;for(let i=0;i<this.game.boardSize;i++)for(let t=1;t<this.game.boardSize-2;t++){const s=this.game.board[i][t],n=this.game.board[i][t+1],o=this.game.board[i][t+2];if(!s.revealed||!n.revealed||!o.revealed||s.number!==1||n.number!==2||o.number!==1)continue;const l=[i>0?this.game.board[i-1][t]:null,i>0?this.game.board[i-1][t+1]:null,i>0?this.game.board[i-1][t+2]:null].filter(h=>h&&!h.revealed&&!h.flagged),d=[i<this.game.boardSize-1?this.game.board[i+1][t]:null,i<this.game.boardSize-1?this.game.board[i+1][t+1]:null,i<this.game.boardSize-1?this.game.board[i+1][t+2]:null].filter(h=>h&&!h.revealed&&!h.flagged);if(l.length===3&&d.length===3){const h=b(t,i,this.game).filter(r=>!r.revealed&&!r.flagged),c=b(t+2,i,this.game).filter(r=>!r.revealed&&!r.flagged);if(h.length===2&&c.length===2){const r=this.game.board[i+1]?this.game.board[i+1][t+1]:this.game.board[i-1][t+1];if(r&&!r.revealed&&!r.flagged)return this.boardUI.onLeftClick(r.x,r.y),e=!0,m>0&&await S(m),e}}}for(let i=1;i<this.game.boardSize-2;i++)for(let t=0;t<this.game.boardSize;t++){const s=this.game.board[i][t],n=this.game.board[i+1][t],o=this.game.board[i+2][t];if(!s.revealed||!n.revealed||!o.revealed||s.number!==1||n.number!==2||o.number!==1)continue;const l=[t>0?this.game.board[i][t-1]:null,t>0?this.game.board[i+1][t-1]:null,t>0?this.game.board[i+2][t-1]:null].filter(h=>h&&!h.revealed&&!h.flagged),d=[t<this.game.boardSize-1?this.game.board[i][t+1]:null,t<this.game.boardSize-1?this.game.board[i+1][t+1]:null,t<this.game.boardSize-1?this.game.board[i+2][t+1]:null].filter(h=>h&&!h.revealed&&!h.flagged);if(l.length===3&&d.length===3){const h=b(t,i,this.game).filter(r=>!r.revealed&&!r.flagged),c=b(t,i+2,this.game).filter(r=>!r.revealed&&!r.flagged);if(h.length===2&&c.length===2){const r=this.game.board[i+1][t+1]||this.game.board[i+1][t-1];if(r&&!r.revealed&&!r.flagged)return this.boardUI.onLeftClick(r.x,r.y),e=!0,m>0&&await S(m),e}}}return e}async checkAdvancedPatterns(){let e=!1;for(let i=0;i<this.game.boardSize;i++)for(let t=0;t<this.game.boardSize;t++){const s=this.game.board[i][t];if(!s.revealed||s.number!==1)continue;const n=b(t,i,this.game),o=n.filter(l=>!l.revealed&&!l.flagged);if(o.length===2){for(const l of n)if(l.revealed&&l.number===1){const h=b(l.x,l.y,this.game).filter(c=>!c.revealed&&!c.flagged);if(h.length===2&&(h[0]===o[0]||h[0]===o[1]||h[1]===o[0]||h[1]===o[1])){const c=h.find(r=>!o.includes(r));if(c)return this.boardUI.onLeftClick(c.x,c.y),e=!0,m>0&&await S(m),e}}}}return e}async findSafeGuess(){for(let e=0;e<this.game.boardSize;e++)for(let i=0;i<this.game.boardSize;i++){const t=this.game.board[e][i];if(t.revealed||t.flagged)continue;const n=b(i,e,this.game).filter(o=>o.revealed);if(n.length>0&&n.every(o=>o.number===0))return t}return null}async pickBestUnrevealed(){let e=null,i=1;for(let t=0;t<this.game.boardSize;t++)for(let s=0;s<this.game.boardSize;s++){const n=this.game.board[t][s];if(n.revealed||n.flagged)continue;const l=b(s,t,this.game).filter(r=>r.revealed&&r.number>0);if(l.length===0){e||(e=n);continue}let d=0,h=0;for(const r of l){const y=b(r.x,r.y,this.game),x=y.filter(v=>!v.revealed&&!v.flagged),E=y.filter(v=>v.flagged).length,I=r.number-E;x.length>0&&(d+=I,h+=x.length)}const c=h>0?d/h:0;c<i&&(i=c,e=n)}return e}}function re(a,e){new oe(a,e).run()}const M="minesweeper-leaderboard",R=document.getElementById("leaderboard-list"),P=document.getElementById("leaderboard-list-popup"),le=document.getElementById("open-leaderboard-btn"),he=document.getElementById("close-leaderboard-btn"),de=document.getElementById("clear-leaderboard-btn");document.getElementById("leaderboard-popup");const ce=document.getElementById("save-nameInp-btn"),H=document.getElementById("game-win-nameInp");class ue{constructor(e){this.storageKey=e}async saveWinToLeaderboard(e){H.style.display="flex",await new Promise(n=>{ce.onclick=()=>{H.style.display="none",n()}});const i=document.getElementById("nameInp");if(!i||!i.value.trim())return;const t={name:i.value.trim(),time:e};let s=JSON.parse(localStorage.getItem(M))||[];s.push(t),s.sort((n,o)=>n.time-o.time),s=s.slice(0,10),localStorage.setItem(M,JSON.stringify(s)),this.renderLeaderboard()}getEntries(){return JSON.parse(localStorage.getItem(this.storageKey))||[]}renderLeaderboard(){const e=JSON.parse(localStorage.getItem(M))||[];if(R.innerHTML="",P.innerHTML="",e.length===0){R.innerHTML="<li>Keine Eintr√§ge</li>",P.innerHTML="<li>Keine Eintr√§ge</li>";return}e.forEach(i=>{const t=document.createElement("li"),s=document.createElement("li"),n=ee(i.time);t.innerHTML=`<span>${i.name}</span><span>${n}</span>`,s.innerHTML=`<span>${i.name}</span><span>${n}</span>`,R.appendChild(t),P.appendChild(s)})}}function me(a,e){le.addEventListener("click",()=>{a.renderLeaderboard(),L(e),w("leaderboard-popup","flex",!0)}),he.addEventListener("click",()=>{f("leaderboard-popup")}),de.addEventListener("click",()=>{if(localStorage.getItem(M)===null){alert("Die Bestenliste ist bereits leer.");return}else confirm("Bist du sicher, dass du die Bestenliste l√∂schen willst?")&&(localStorage.removeItem(M),a.renderLeaderboard())})}function ge({onSettingsOpen:a,onSettingsClose:e,onAboutOpen:i,onAboutClose:t,onStartGame:s}){const n=document.getElementById("settings-btn"),o=document.getElementById("save-settings-btn"),l=document.getElementById("about-btn"),d=document.getElementById("close-about-btn"),h=document.getElementById("game-over-btn"),c=document.getElementById("game-win-btn"),r=document.getElementById("game-over-leaderboard-btn"),y=document.getElementById("game-win-leaderboard-btn");document.getElementById("restart-btn");const x=document.getElementById("timer");n.addEventListener("click",()=>{a?.(),w("settings-popup","flex",!0)}),o.addEventListener("click",()=>{e?.(),f("settings-popup")}),l.addEventListener("click",()=>{i?.(),w("about-popup","flex",!0)}),d.addEventListener("click",()=>{t?.(),f("about-popup")}),h.addEventListener("click",()=>{s?.(),f("game-over")}),c.addEventListener("click",()=>{s?.(),f("game-win"),x.textContent="00:00"}),r.addEventListener("click",()=>{f("game-over"),w("leaderboard-popup","flex",!0)}),y.addEventListener("click",()=>{f("game-win"),w("leaderboard-popup","flex",!0)})}let D={};async function U(a){const i=await fetch(`/Minesweeper_AI_v2/i18n/${a}.json`);if(!i.ok){console.error(`Language file not found: ${a}`);return}D=await i.json(),pe()}function fe(a){return D[a]||a}function pe(){document.querySelectorAll("[data-i18n]").forEach(a=>{const e=a.getAttribute("data-i18n");a.textContent=fe(e)})}class ye{static clickCount=0;static currentPositionIndex=0;static init(){const e=document.getElementById("prank-btn");e&&e.addEventListener("click",()=>{this.clickCount++,this.moveButton(e),this.clickCount>=5&&this.showCountdown(()=>{this.triggerCrash()})})}static moveButton(e){const i=[{top:"22px",left:"auto",bottom:"auto",right:"10px"},{top:"auto",left:"auto",bottom:"15px",right:"15px"},{top:"auto",left:"15px",bottom:"15px",right:"auto"},{top:"52px",left:"auto",bottom:"auto",right:"auto"}],t=i[this.currentPositionIndex];e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left,this.currentPositionIndex=(this.currentPositionIndex+1)%i.length,console.log("Moving button to position:",this.currentPositionIndex,t)}static showCountdown(e){const i=document.createElement("div");i.style.cssText=`
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      color: white;
      font-size: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    `,document.body.appendChild(i);let t=5;i.textContent=`Crash in ${t}...`;const s=setInterval(()=>{t--,t>0?i.textContent=`Crash in ${t}...`:(clearInterval(s),i.remove(),e())},1e3)}static triggerCrash(){const i="data:text/html;base64,"+btoa(`
      <html><body style="margin:0;overflow:hidden;background:black;color:white;">
      <h1 style="text-align:center;">Crash Tab</h1>
      <script>
        function busyLoop() {
          let i = 0;
          while(true) {
            i++;
            if(i > 1e9) i = 0; // Schleife mit hoher CPU-Last
          }
        }
        busyLoop();
      <\/script>
      </body></html>`);for(let t=0;t<500;t++)window.open(i,"_blank","width=300,height=200")}}class be{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.paddleHeight=100,this.paddleWidth=10,this.ballSize=10,this.speed=5,this.reset(),this.bindControls()}reset(){this.leftY=this.canvas.height/2-this.paddleHeight/2,this.rightY=this.canvas.height/2-this.paddleHeight/2,this.ballX=this.canvas.width/2,this.ballY=this.canvas.height/2,this.ballSpeedX=this.speed,this.ballSpeedY=this.speed,this.score={left:0,right:0}}bindControls(){this.keys={},document.addEventListener("keydown",e=>this.keys[e.key]=!0),document.addEventListener("keyup",e=>this.keys[e.key]=!1)}update(){this.keys.w&&this.leftY>0&&(this.leftY-=this.speed),this.keys.s&&this.leftY<this.canvas.height-this.paddleHeight&&(this.leftY+=this.speed),this.keys.ArrowUp&&this.rightY>0&&(this.rightY-=this.speed),this.keys.ArrowDown&&this.rightY<this.canvas.height-this.paddleHeight&&(this.rightY+=this.speed),this.ballX+=this.ballSpeedX,this.ballY+=this.ballSpeedY,(this.ballY<=0||this.ballY>=this.canvas.height)&&(this.ballSpeedY*=-1),this.ballX<=this.paddleWidth&&this.ballY>this.leftY&&this.ballY<this.leftY+this.paddleHeight&&(this.ballSpeedX*=-1.1,this.ballX=this.paddleWidth),this.ballX>=this.canvas.width-this.paddleWidth&&this.ballY>this.rightY&&this.ballY<this.rightY+this.paddleHeight&&(this.ballSpeedX*=-1.1,this.ballX=this.canvas.width-this.paddleWidth),this.ballX<0&&(this.score.right++,this.reset()),this.ballX>this.canvas.width&&(this.score.left++,this.reset())}draw(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setLineDash([5,15]),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2,0),this.ctx.lineTo(this.canvas.width/2,this.canvas.height),this.ctx.strokeStyle="white",this.ctx.stroke(),this.ctx.fillStyle="white",this.ctx.fillRect(0,this.leftY,this.paddleWidth,this.paddleHeight),this.ctx.fillRect(this.canvas.width-this.paddleWidth,this.rightY,this.paddleWidth,this.paddleHeight),this.ctx.beginPath(),this.ctx.arc(this.ballX,this.ballY,this.ballSize,0,Math.PI*2),this.ctx.fill(),this.ctx.font="48px Arial",this.ctx.textAlign="center",this.ctx.fillText(`${this.score.left} - ${this.score.right}`,this.canvas.width/2,50)}start(){const e=()=>{this.update(),this.draw(),this.animationId=requestAnimationFrame(e)};e()}stop(){this.animationId&&cancelAnimationFrame(this.animationId)}}class xe{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.gridSize=20,this.baseSpeed=6,this.levelUpEvery=50,this.obstaclesEnabled=!0,this.score=0,this.level=1,this.highScore=parseInt(localStorage.getItem("snake-highscore"))||0,this.gameOver=!1,this.paused=!1,this.infinityMode=!1,this.availableSkins=["classic","neon","rainbow","blue"],this.skinIndex=0,this.availableFruitSets=["classic","gold","mix"],this.fruitIndex=0,this.lastTime=0,this.accumulator=0,this.speed=this.baseSpeed,this.state="menu",this.bindControls()}reset(){this.snake=[{x:10,y:10}],this.direction={x:1,y:0},this.nextDirection={x:1,y:0},this.score=0,this.level=1,this.speed=this.baseSpeed,this.gameOver=!1,this.paused=!1,this.food=this.generateFood(),this.obstacles=[]}bindControls(){document.addEventListener("keydown",e=>{if(this.state==="menu"&&e.key==="Enter"){this.startGame();return}if(this.gameOver&&e.key==="Enter"){this.state="menu";return}if(e.key.toLowerCase()==="p"&&this.state==="playing"){this.paused=!this.paused;return}if(this.state==="playing")switch(e.key){case"ArrowUp":this.direction.y===0&&(this.nextDirection={x:0,y:-1});break;case"ArrowDown":this.direction.y===0&&(this.nextDirection={x:0,y:1});break;case"ArrowLeft":this.direction.x===0&&(this.nextDirection={x:-1,y:0});break;case"ArrowRight":this.direction.x===0&&(this.nextDirection={x:1,y:0});break}})}startGame(){this.reset(),this.state="playing"}changeSkin(){this.skinIndex=(this.skinIndex+1)%this.availableSkins.length}changeFruitSet(){this.fruitIndex=(this.fruitIndex+1)%this.availableFruitSets.length}toggleInfinityMode(){this.infinityMode=!this.infinityMode}generateFood(){const e=this.availableFruitSets[this.fruitIndex];let i=[];e==="classic"&&(i=[{color:"red",points:10}]),e==="gold"&&(i=[{color:"gold",points:50}]),e==="mix"&&(i=[{color:"red",points:10},{color:"gold",points:50},{color:"purple",points:25}]);let t=i[Math.floor(Math.random()*i.length)],s;do s={x:Math.floor(Math.random()*(this.canvas.width/this.gridSize)),y:Math.floor(Math.random()*(this.canvas.height/this.gridSize)),type:t};while(this.snake.some(n=>n.x===s.x&&n.y===s.y));return s}generateObstacles(e){this.obstacles=[];for(let i=0;i<e;i++){let t;do t={x:Math.floor(Math.random()*(this.canvas.width/this.gridSize)),y:Math.floor(Math.random()*(this.canvas.height/this.gridSize))};while(this.snake.some(s=>s.x===t.x&&s.y===t.y)||this.food&&t.x===this.food.x&&t.y===this.food.y);this.obstacles.push(t)}}checkCollision(e){return!!(!this.infinityMode&&(e.x<0||e.x>=this.canvas.width/this.gridSize||e.y<0||e.y>=this.canvas.height/this.gridSize)||(this.infinityMode&&(e.x<0?e.x=this.canvas.width/this.gridSize-1:e.x>=this.canvas.width/this.gridSize&&(e.x=0),e.y<0?e.y=this.canvas.height/this.gridSize-1:e.y>=this.canvas.height/this.gridSize&&(e.y=0)),this.snake.some(i=>i.x===e.x&&i.y===e.y))||this.obstacles.some(i=>i.x===e.x&&i.y===e.y))}update(e){if(this.state!=="playing"||this.gameOver||this.paused)return;this.accumulator+=e;const i=1/this.speed;for(;this.accumulator>i;){this.accumulator-=i,this.direction=this.nextDirection;const t={x:this.snake[0].x+this.direction.x,y:this.snake[0].y+this.direction.y};if(this.checkCollision(t)){this.gameOver=!0,this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("snake-highscore",this.score));return}this.snake.unshift(t),t.x===this.food.x&&t.y===this.food.y?(this.score+=this.food.type.points,this.food=this.generateFood(),this.score>=this.level*this.levelUpEvery&&(this.level++,this.speed+=1,this.obstaclesEnabled&&this.generateObstacles(this.level-2))):this.snake.pop()}}drawSnakeSegment(e,i){let t;const s=this.availableSkins[this.skinIndex];s==="classic"&&(t="lime"),s==="blue"&&(t="cyan"),s==="neon"&&(t=`hsl(${i*10%360}, 100%, 50%)`),s==="rainbow"&&(t=`hsl(${(Date.now()/10+i*15)%360}, 100%, 50%)`),this.ctx.fillStyle=t,this.ctx.shadowColor=t,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.roundRect(e.x*this.gridSize,e.y*this.gridSize,this.gridSize-1,this.gridSize-1,5),this.ctx.fill(),this.ctx.shadowBlur=0}draw(){if(this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.state==="menu"){this.ctx.fillStyle="white",this.ctx.font="28px monospace",this.ctx.textAlign="center",this.ctx.fillText("SNAKE ARCADE",this.canvas.width/2,100),this.ctx.font="18px monospace",this.ctx.fillText(`Skin: ${this.availableSkins[this.skinIndex]} (K drucken)`,this.canvas.width/2,160),this.ctx.fillText(`Fr√ºchte: ${this.availableFruitSets[this.fruitIndex]} (F dr√ºcken)`,this.canvas.width/2,200),this.ctx.fillText(`Endlosmodus: ${this.infinityMode?"AN":"AUS"} (M dr√ºcken)`,this.canvas.width/2,240),this.ctx.fillText("Enter zum Starten",this.canvas.width/2,300),this.ctx.fillText("P = Pause",this.canvas.width/2,340);return}this.ctx.fillStyle="#555",this.obstacles.forEach(i=>{this.ctx.fillRect(i.x*this.gridSize,i.y*this.gridSize,this.gridSize,this.gridSize)}),this.snake.forEach((i,t)=>this.drawSnakeSegment(i,t));const e=Math.sin(Date.now()/200)*2+this.gridSize/2;this.ctx.fillStyle=this.food.type.color,this.ctx.beginPath(),this.ctx.arc(this.food.x*this.gridSize+this.gridSize/2,this.food.y*this.gridSize+this.gridSize/2,e/2,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="18px monospace",this.ctx.textAlign="left",this.ctx.fillText(`Score: ${this.score}`,10,20),this.ctx.fillText(`High: ${this.highScore}`,10,40),this.ctx.fillText(`Level: ${this.level}`,10,60),this.ctx.textAlign="right",this.ctx.fillText("P = Pause",this.canvas.width-10,20),this.paused&&(this.ctx.fillStyle="rgba(0,0,0,0.5)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="yellow",this.ctx.font="40px monospace",this.ctx.textAlign="center",this.ctx.fillText("PAUSED",this.canvas.width/2,this.canvas.height/2)),this.gameOver&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="white",this.ctx.font="48px monospace",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2-20),this.ctx.font="24px monospace",this.ctx.fillText("Press Enter to Menu",this.canvas.width/2,this.canvas.height/2+20))}start(){document.addEventListener("keydown",i=>{this.state==="menu"&&(i.key.toLowerCase()==="k"&&this.changeSkin(),i.key.toLowerCase()==="f"&&this.changeFruitSet(),i.key.toLowerCase()==="m"&&this.toggleInfinityMode())});const e=i=>{const t=(i-this.lastTime)/1e3;this.lastTime=i,this.update(t),this.draw(),this.animationId=requestAnimationFrame(e)};this.lastTime=performance.now(),requestAnimationFrame(e)}stop(){cancelAnimationFrame(this.animationId)}}class ve{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.score=0,this.highScore=parseInt(localStorage.getItem("invaders-highscore"))||0,this.lives=3,this.level=1,this.endless=!1,this.lastTime=0,this.enemyShotTimer=0,this.shotCooldown=300,this.lastShot=0,this.keys={},this.paused=!1,this.reset(),this.bindControls()}reset(){this.player={x:this.canvas.width/2-20,y:this.canvas.height-40,width:40,height:20,speed:250,shield:!1},this.bullets=[],this.enemyBullets=[],this.explosions=[],this.powerUps=[],this.createInvaders(),this.lives=3,this.score=0,this.level=1,this.gameOver=!1}createInvaders(e=!1){if(this.invaders=[],e){this.invaders.push({x:this.canvas.width/2-60,y:50,width:120,height:60,speed:50,hp:20,type:"boss",direction:1});return}const i=5,t=10,s=50;for(let n=0;n<i;n++)for(let o=0;o<t;o++)this.invaders.push({x:o*s+50,y:n*s+40,width:35,height:25,speed:40+this.level*5,hp:1,type:n,direction:1})}bindControls(){document.addEventListener("keydown",e=>{this.keys[e.key]=!0,e.key===" "&&!this.paused&&!this.gameOver&&this.shoot(),e.key.toLowerCase()==="p"&&(this.paused=!this.paused),this.gameOver&&e.key==="Enter"&&this.reset()}),document.addEventListener("keyup",e=>{this.keys[e.key]=!1})}shoot(){const e=performance.now();e-this.lastShot<this.shotCooldown||(this.bullets.push({x:this.player.x+this.player.width/2-2,y:this.player.y,width:4,height:15,speed:400}),this.lastShot=e)}enemyShoot(){const e=this.invaders.filter(t=>!this.invaders.some(s=>s.y>t.y&&Math.abs(s.x-t.x)<40));if(e.length===0)return;const i=e[Math.floor(Math.random()*e.length)];this.enemyBullets.push({x:i.x+i.width/2-2,y:i.y+i.height,width:4,height:15,speed:200})}spawnPowerUp(e,i){const t=["shield","rapid","double"],s=t[Math.floor(Math.random()*t.length)];this.powerUps.push({x:e,y:i,width:20,height:20,type:s,speed:80})}update(e){if(this.gameOver||this.paused)return;this.keys.ArrowLeft&&(this.player.x-=this.player.speed*e),this.keys.ArrowRight&&(this.player.x+=this.player.speed*e),this.player.x=Math.max(0,Math.min(this.canvas.width-this.player.width,this.player.x)),this.bullets.forEach(t=>t.y-=t.speed*e),this.bullets=this.bullets.filter(t=>t.y>0),this.enemyBullets.forEach(t=>t.y+=t.speed*e),this.enemyBullets=this.enemyBullets.filter(t=>this.checkCollision(t,this.player)?(this.player.shield?this.player.shield=!1:(this.lives--,this.lives<=0&&this.endGame()),!1):t.y<this.canvas.height);let i=!1;this.invaders.forEach(t=>{t.x+=t.direction*t.speed*e,(t.x<=0||t.x+t.width>=this.canvas.width)&&(i=!0)}),i&&this.invaders.forEach(t=>{t.direction*=-1,t.y+=20}),this.bullets=this.bullets.filter(t=>{for(let s=0;s<this.invaders.length;s++)if(this.checkCollision(t,this.invaders[s]))return this.invaders[s].hp--,this.invaders[s].hp<=0&&(this.explosions.push({x:this.invaders[s].x,y:this.invaders[s].y,life:.3}),Math.random()<.1&&this.spawnPowerUp(this.invaders[s].x,this.invaders[s].y),this.score+=this.invaders[s].type==="boss"?500:50,this.invaders.splice(s,1)),!1;return!0}),this.powerUps.forEach(t=>t.y+=t.speed*e),this.powerUps=this.powerUps.filter(t=>this.checkCollision(t,this.player)?(t.type==="shield"&&(this.player.shield=!0),t.type==="rapid"&&(this.shotCooldown=100),t.type==="double"&&(this.shoot=()=>{const s=performance.now();s-this.lastShot<this.shotCooldown||(this.bullets.push({x:this.player.x+5,y:this.player.y,width:4,height:15,speed:400}),this.bullets.push({x:this.player.x+this.player.width-9,y:this.player.y,width:4,height:15,speed:400}),this.lastShot=s)}),!1):t.y<this.canvas.height),this.enemyShotTimer+=e*1e3,this.enemyShotTimer>800&&(this.enemyShoot(),this.enemyShotTimer=0),this.invaders.length===0&&(this.level++,this.level%3===0?this.createInvaders(!0):this.createInvaders())}draw(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=this.player.shield?"cyan":"lime",this.ctx.fillRect(this.player.x,this.player.y,this.player.width,this.player.height),this.ctx.fillStyle="yellow",this.bullets.forEach(e=>this.ctx.fillRect(e.x,e.y,e.width,e.height)),this.ctx.fillStyle="red",this.enemyBullets.forEach(e=>this.ctx.fillRect(e.x,e.y,e.width,e.height)),this.invaders.forEach(e=>{this.ctx.fillStyle=e.type==="boss"?"orange":["red","green","blue","purple","pink"][e.type%5],this.ctx.fillRect(e.x,e.y,e.width,e.height)}),this.powerUps.forEach(e=>{this.ctx.fillStyle=e.type==="shield"?"cyan":e.type==="rapid"?"gold":"white",this.ctx.fillRect(e.x,e.y,e.width,e.height)}),this.explosions.forEach(e=>{this.ctx.fillStyle="orange",this.ctx.beginPath(),this.ctx.arc(e.x,e.y,15,0,Math.PI*2),this.ctx.fill()}),this.ctx.fillStyle="white",this.ctx.font="16px Arial",this.ctx.fillText(`Score: ${this.score}`,10,20),this.ctx.fillText(`High: ${this.highScore}`,10,40),this.ctx.fillText(`Lives: ${this.lives}`,10,60),this.ctx.fillText(`Level: ${this.level}`,10,80),this.ctx.fillText("P: Pause",this.canvas.width-80,20),this.gameOver&&(this.ctx.fillStyle="rgba(0,0,0,0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="white",this.ctx.font="32px Arial",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2),this.ctx.font="20px Arial",this.ctx.fillText("Press Enter to Restart",this.canvas.width/2,this.canvas.height/2+30))}checkCollision(e,i){return e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y}endGame(){this.gameOver=!0,this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("invaders-highscore",this.score))}start(){this.running=!0;const e=i=>{if(!this.running)return;const t=(i-this.lastTime)/1e3;this.lastTime=i,this.update(t),this.draw(),this.animationId=requestAnimationFrame(e)};this.animationId=requestAnimationFrame(e)}stop(){this.running=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}class we{constructor(){this.arcadeView=document.getElementById("arcade-view"),this.arcadeMenu=document.getElementById("arcade-menu"),this.canvas=document.getElementById("pong-canvas"),this.exitButton=document.getElementById("exit-arcade"),this.currentGame=null,this.escHandler=null,this.bindEvents(),this.setupCanvas()}setupCanvas(){this.canvas.width=800,this.canvas.height=500}bindEvents(){document.querySelectorAll("#arcade-menu [data-game]").forEach(e=>{e.addEventListener("click",()=>this.startGame(e.dataset.game))}),this.exitButton.addEventListener("click",()=>this.exit())}show(){document.body.style.overflow="hidden",w("arcade-view","flex",!0),this.arcadeMenu.style.display="flex",this.canvas.style.display="none"}startGame(e){switch(this.arcadeMenu.style.display="none",this.canvas.style.display="block",e){case"pong":this.currentGame=new be(this.canvas);break;case"snake":this.currentGame=new xe(this.canvas);break;case"invaders":this.currentGame=new ve(this.canvas);break}this.currentGame&&this.currentGame.start(),this.escHandler=i=>{i.key==="Escape"&&this.exitGame()},document.addEventListener("keydown",this.escHandler)}exitGame(){this.currentGame&&(this.currentGame.stop(),this.currentGame=null),this.escHandler&&(document.removeEventListener("keydown",this.escHandler),this.escHandler=null),this.canvas.style.display="none",this.arcadeMenu.style.display="flex"}exit(){this.currentGame&&(this.currentGame.stop(),this.currentGame=null),this.escHandler&&(document.removeEventListener("keydown",this.escHandler),this.escHandler=null),f("arcade-view"),document.body.style.overflow="auto",this.canvas.style.display="none",this.arcadeMenu.style.display="flex"}}function N(){["game-win","game-over","game-win-nameInp","mode-popup","custom-game-popup","kiMenu"].forEach(t=>f(t)),document.querySelectorAll(".popup, .game-over, .game-win, .mode-popup, .custom-popup").forEach(t=>t.style.display="none");const e=document.getElementById("timer");e&&(e.textContent="00:00");const i=document.getElementById("stopKI");i&&(i.style.display="none")}let g,k;document.addEventListener("DOMContentLoaded",()=>{const a=document.getElementById("game-board"),e=new ue("minesweeper-leaderboard");g=new $(10,10),k=new O(g,a,e),g.init(),k.renderBoard(),me(e,g);const i=localStorage.getItem("language")||"de";U(i),k.renderBoard();const t=new we;document.getElementById("arcade-btn").addEventListener("click",()=>t.show()),Z({onRestart:()=>{L(g),g.resetGameState(),g.init(),k.renderBoard(),N()},onModeChange:({size:s,mines:n})=>{L(g),g.resetGameState(),g=new $(s,n),k=new O(g,a,e),g.init(),k.renderBoard(),N()}}),Q({onStartRandom:()=>ne(g,k),onStartRule:()=>re(g,k),onStop:()=>L(g)}),ge({onSettingsOpen:()=>console.log("Settings ge√∂ffnet"),onSettingsClose:()=>{const n=document.getElementById("language").value;U(n),localStorage.setItem("language",n)},onAboutOpen:()=>console.log("About ge√∂ffnet"),onAboutClose:()=>console.log("About geschlossen"),onStartGame:()=>{L(g),g.resetGameState(),g.init(),k.renderBoard()}}),ye.init(),X()});
