(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const Z=document.getElementById("timer");function Q(o){o.startTime||(o.startTime=Date.now());const t=Date.now(),e=Math.floor((t-o.startTime)/1e3),i=Math.floor(e/60).toString().padStart(2,"0"),s=(e%60).toString().padStart(2,"0");Z.textContent=`${i}:${s}`}class N{constructor(t,e){this.boardSize=t,this.mineCount=e,this.board=[],this.gameOver=!1,this.startTime=null,this.timerInterval=null,this.kiRunning=!1,this.kiTimeout=null}init(){this.board=[],this.gameOver=!1,this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.startTime=null,this.generateBoard(),this.placeMines(),this.calculateNumbers()}generateBoard(){for(let t=0;t<this.boardSize;t++){this.board[t]=[];for(let e=0;e<this.boardSize;e++)this.board[t][e]={x:e,y:t,mine:!1,revealed:!1,flagged:!1,number:0}}}placeMines(){let t=0;for(;t<this.mineCount;){const e=Math.floor(Math.random()*this.boardSize),i=Math.floor(Math.random()*this.boardSize),s=this.board[i][e];s.mine||(s.mine=!0,t++)}}calculateNumbers(){for(let t=0;t<this.boardSize;t++)for(let e=0;e<this.boardSize;e++){const i=this.board[t][e];i.mine||(i.number=this.countNeighborMines(e,t))}}countNeighborMines(t,e){let i=0;for(let s=-1;s<=1;s++)for(let n=-1;n<=1;n++){if(n===0&&s===0)continue;const a=t+n,r=e+s;a>=0&&a<this.boardSize&&r>=0&&r<this.boardSize&&this.board[r][a].mine&&i++}return i}revealCell(t,e){if(this.gameOver)return{changed:[],result:"ignore"};const i=this.board[e][t];if(i.revealed||i.flagged)return{changed:[],result:"ignore"};const s=[],n=(a,r)=>{const d=[[a,r]],h=new Set;for(;d.length>0;){const[c,l]=d.pop(),b=`${c},${l}`;if(h.has(b))continue;h.add(b);const v=this.board[l][c];if(!v.revealed&&(v.revealed=!0,s.push({x:c,y:l}),v.number===0&&!v.mine))for(let T=-1;T<=1;T++)for(let I=-1;I<=1;I++){const x=c+I,z=l+T;x>=0&&x<this.boardSize&&z>=0&&z<this.boardSize&&d.push([x,z])}}};return i.mine?this.kiRunning?(this.gameOver=!0,{changed:s,result:"ki"}):(this.gameOver=!0,this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),{changed:[{x:t,y:e}],result:"lose"}):(n(t,e),this.checkWin()?(this.kiRunning&&(this.kiRunning=!1),this.gameOver=!0,this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),{changed:s,result:"win"}):{changed:s,result:"ok"})}toggleFlag(t,e){if(this.gameOver)return;const i=this.board[e][t];if(!i.revealed)return i.flagged=!i.flagged,{x:t,y:e}}checkWin(){return this.board.every(t=>t.every(e=>e.mine||e.revealed))}getCell(t,e){return this.board[e][t]}startTimer(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.startTime=Date.now(),this.timerInterval=setInterval(()=>Q(this),1e3)}resetGameState(){this.timerInterval&&(clearInterval(this.timerInterval),this.timerInterval=null),this.startTime=null,this.kiRunning=!1,this.kiTimeout&&(clearTimeout(this.kiTimeout),this.kiTimeout=null),this.gameOver=!0}}let M=null;function p(o){const t=document.getElementById(o);t&&(t.style.display="none",document.body.classList.remove("popup-open"),M===o&&(M=null),o==="arcade-view"&&(document.body.style.overflow="auto"))}function w(o,t,e){const i=document.getElementById(o);i&&(i.style.display=t||"block",e&&document.body.classList.add("popup-open"),M=o)}function tt(){document.addEventListener("click",o=>{if(o.target.classList.contains("popup")&&M){if(M==="arcade-view"){const t=document.getElementById("pong-canvas");if(t&&t.style.display!=="none")return}p(M)}})}const U="minesweeper-statistics";class et{constructor(){this.stats=this.loadStats()}loadStats(){const t=localStorage.getItem(U);return t?JSON.parse(t):this.getDefaultStats()}getDefaultStats(){return{human:{gamesPlayed:0,gamesWon:0,gamesLost:0,totalTime:0,bestTime:null,byDifficulty:{beginner:{played:0,won:0,totalTime:0},intermediate:{played:0,won:0,totalTime:0},advanced:{played:0,won:0,totalTime:0},expert:{played:0,won:0,totalTime:0},custom:{played:0,won:0,totalTime:0}}},ai:{gamesPlayed:0,gamesWon:0,gamesLost:0,totalTime:0,bestTime:null}}}saveStats(){localStorage.setItem(U,JSON.stringify(this.stats))}getDifficulty(t,e){return t===4&&e===1?"beginner":t===10&&e===10?"intermediate":t===14&&e===30?"advanced":t===18&&e===50?"expert":"custom"}recordGameStart(t,e,i){const s=t?"ai":"human";if(this.stats[s].gamesPlayed++,!t){const n=this.getDifficulty(e,i);this.stats.human.byDifficulty[n].played++}this.saveStats()}recordGameEnd(t,e,i,s,n){const a=t?"ai":"human";if(e){if(this.stats[a].gamesWon++,this.stats[a].totalTime+=i,(!this.stats[a].bestTime||i<this.stats[a].bestTime)&&(this.stats[a].bestTime=i),!t){const r=this.getDifficulty(s,n);this.stats.human.byDifficulty[r].won++,this.stats.human.byDifficulty[r].totalTime+=i}}else this.stats[a].gamesLost++;this.saveStats()}getWinRate(t){const e=this.stats[t];return e.gamesPlayed===0?0:(e.gamesWon/e.gamesPlayed*100).toFixed(1)}getAverageTime(t){const e=this.stats[t];return e.gamesWon===0?0:Math.round(e.totalTime/e.gamesWon)}getDifficultyWinRate(t){const e=this.stats.human.byDifficulty[t];return e.played===0?0:(e.won/e.played*100).toFixed(1)}getDifficultyAverageTime(t){const e=this.stats.human.byDifficulty[t];return e.won===0?0:Math.round(e.totalTime/e.won)}resetStats(){this.stats=this.getDefaultStats(),this.saveStats()}getStats(){return this.stats}}const S=new et;function R(o){const t=Math.floor(o/60).toString().padStart(2,"0"),e=(o%60).toString().padStart(2,"0");return`${t}:${e}`}function B(o){return new Promise(t=>setTimeout(t,o))}function y(o,t,e){const i=[];for(let s=-1;s<=1;s++)for(let n=-1;n<=1;n++){if(s===0&&n===0)continue;const a=o+s,r=t+n;if(a>=0&&a<e.boardSize&&r>=0&&r<e.boardSize){const d=e.board[r][a];i.push({...d,x:a,y:r})}}return i}class Y{constructor(t,e,i){this.game=t,this.element=e,this.leaderboard=i,this.heatmap=null,this.gameStartedAsAI=!1}setHeatmap(t){this.heatmap=t}updateStatsDisplay(){const t=S.getStats();document.getElementById("stat-games-played").textContent=t.human.gamesPlayed,document.getElementById("stat-win-rate").textContent=S.getWinRate("human")+"%";const e=S.getAverageTime("human");document.getElementById("stat-avg-time").textContent=e>0?R(e):"--";const i=t.human.bestTime;document.getElementById("stat-best-time").textContent=i!==null?R(i):"--"}renderBoard(){this.element.innerHTML="",this.element.style.gridTemplateColumns=`repeat(${this.game.boardSize}, 30px)`,this.element.style.gridTemplateRows=`repeat(${this.game.boardSize}, 30px)`;for(let t=0;t<this.game.boardSize;t++)for(let e=0;e<this.game.boardSize;e++){const i=document.createElement("div");i.classList.add("cell"),i.dataset.x=e,i.dataset.y=t,i.addEventListener("click",()=>this.onLeftClick(e,t)),i.addEventListener("contextmenu",s=>{s.preventDefault(),this.onRightClick(e,t)}),this.element.appendChild(i)}}onLeftClick(t,e){this.game.startTime||(this.game.startTimer(),this.gameStartedAsAI=this.game.kiRunning,S.recordGameStart(this.gameStartedAsAI,this.game.boardSize,this.game.mineCount));const i=this.game.revealCell(t,e);if(i.changed.forEach(({x:s,y:n})=>this.updateCell(s,n)),this.heatmap&&this.heatmap.update(),i.result==="ki"&&(this.revealAllMinesUI(),this.updateBoard()),i.result==="lose"&&(this.revealAllMinesUI(),S.recordGameEnd(this.gameStartedAsAI,!1,0,this.game.boardSize,this.game.mineCount),this.updateStatsDisplay(),this.heatmap&&this.heatmap.clear(),w("game-over","flex",!0)),i.result==="win"){this.revealAllMinesUI();const s=Date.now(),n=Math.floor((s-this.game.startTime)/1e3);S.recordGameEnd(this.gameStartedAsAI,!0,n,this.game.boardSize,this.game.mineCount),this.updateStatsDisplay(),this.heatmap&&this.heatmap.clear(),w("game-win","flex",!0);try{this.leaderboard.saveWinToLeaderboard(n)}catch(a){console.error("Failed to save in leaderboard:",a)}}}onRightClick(t,e){this.game.startTime||(this.game.startTimer(),this.gameStartedAsAI=this.game.kiRunning,S.recordGameStart(this.gameStartedAsAI,this.game.boardSize,this.game.mineCount)),this.game.toggleFlag(t,e),this.updateCell(t,e),this.heatmap&&this.heatmap.update()}updateBoard(){for(let t=0;t<this.game.boardSize;t++)for(let e=0;e<this.game.boardSize;e++)this.updateCell(e,t)}updateCell(t,e){const i=this.game.getCell(t,e),s=e*this.game.boardSize+t,n=this.element.children[s];n.classList.toggle("revealed",i.revealed),n.classList.toggle("mine",i.revealed&&i.mine),n.classList.toggle("flagged",i.flagged&&!i.revealed),i.revealed&&i.number>0&&!i.mine?n.dataset.number=i.number:delete n.dataset.number,n.textContent="",i.revealed&&i.number>0&&!i.mine&&(n.textContent=i.number)}revealAllMinesUI(){for(let t=0;t<this.game.boardSize;t++)for(let e=0;e<this.game.boardSize;e++){const i=this.game.getCell(e,t);i.mine&&(i.revealed=!0,this.updateCell(e,t))}}}const it=document.getElementById("stopKI"),st=document.getElementById("startRandomKI"),nt=document.getElementById("startRuleKI"),at=document.getElementById("gameIterations");let f=.1,O=0;function ot(o){f=o}function X(){O++,j()}function G(){O=0,j()}function j(){at.textContent=O}function A(o){o&&(o.kiRunning=!1,console.log("Anzahl der Spiele: "+O),p("stopKI"),p("kiMenu"))}function rt({onStartRandom:o,onStartRule:t,onStop:e}){st.addEventListener("click",o),nt.addEventListener("click",t),it.addEventListener("click",e)}let J={};async function F(o){const e=await fetch(`/Minesweeper_AI_v2/i18n/${o}.json`);if(!e.ok){console.error(`Language file not found: ${o}`);return}J=await e.json(),lt()}function $(o){return J[o]||o}function lt(){document.querySelectorAll("[data-i18n]").forEach(o=>{const t=o.getAttribute("data-i18n");o.textContent=$(t)}),document.querySelectorAll("[data-i18n-placeholder]").forEach(o=>{const t=o.getAttribute("data-i18n-placeholder");o.placeholder=$(t)}),document.querySelectorAll("[data-i18n-title]").forEach(o=>{const t=o.getAttribute("data-i18n-title");o.title=$(t)})}function L(o){return $(o)}function ht({onRestart:o,onModeChange:t}){const e=document.getElementById("restart-btn"),i=document.getElementById("start-btn"),s=document.querySelectorAll(".mode-btn"),n=document.getElementById("kiActBtn"),a=document.getElementById("kiMenu"),r=document.getElementById("game-board"),d=document.getElementById("mine-count"),h=document.getElementById("timer"),c=document.getElementById("custom-size"),l=document.getElementById("custom-mines"),b=document.getElementById("start-custom-game-btn"),v=document.getElementById("cancel-custom-game-btn"),T=document.getElementById("mineIconButton");let I=0;const x=document.getElementById("kiSpeed"),z=document.getElementById("kiSpeedValue");e.addEventListener("click",()=>{h.textContent="00:00",G(),o()}),i.addEventListener("click",()=>{w("mode-popup","flex",!0)}),s.forEach(m=>{m.addEventListener("click",()=>{const u=parseInt(m.getAttribute("data-size"),10),C=parseInt(m.getAttribute("data-mines"),10);if(isNaN(u)||isNaN(C)){w("custom-game-popup","flex",!0),p("mode-popup");return}r.style.gridTemplateColumns=`repeat(${u}, 30px)`,r.style.gridTemplateRows=`repeat(${u}, 30px)`,G(),t({size:u,mines:C}),p("mode-popup"),h.textContent="00:00",d.textContent=`${C}`})}),b.addEventListener("click",()=>{const m=parseInt(c.value,10),u=parseInt(l.value,10);if(isNaN(m)||m<4||m>100){alert(L("invalidBoardSize")||"Spielfeldgröße muss zwischen 4 und 100 liegen.");return}if(isNaN(u)||u<1||u>1e3){alert(L("invalidMineCount")||"Minenanzahl muss zwischen 1 und 1000 liegen.");return}if(u>=m*m){alert(L("tooManyMines")||"Zu viele Minen für die Spielfeldgröße.");return}r.style.gridTemplateColumns=`repeat(${m}, 30px)`,r.style.gridTemplateRows=`repeat(${m}, 30px)`,G(),t({size:m,mines:u}),p("custom-game-popup"),h.textContent="00:00",d.textContent=`${u}`}),v.addEventListener("click",()=>{p("custom-game-popup")}),T.addEventListener("click",()=>{const m="/Minesweeper_AI_v2/",u=[`${m}assets/Pictures/Bomb1.jpeg`,`${m}assets/Pictures/Bomb.jpg`,`${m}assets/Pictures/Bomb2.jpg`,`${m}assets/Pictures/Bomb3.webp`];I=(I+1)%u.length;const C=document.getElementById("mineIconImg");C.src=u[I],document.documentElement.style.setProperty("--bomb-image",`url('${u[I]}')`)}),n.addEventListener("click",()=>{const m=getComputedStyle(a),u=n.querySelector("span");if(m.display==="none"){u&&(u.textContent=L("stopKILabel"));const C=n.getBoundingClientRect();a.style.left=`${C.left}px`,a.style.top=`${C.bottom+window.scrollY}px`,w("kiMenu","block",!1)}else p("kiMenu"),u&&(u.textContent=L("startKI"))}),x.addEventListener("input",()=>{const m=parseFloat(x.value);console.log(`KI-Geschwindigkeit geändert: ${m}s`),ot(m),z.textContent=m.toFixed(2)+"s"})}function V(){const o=S.getStats();document.getElementById("stat-games-played").textContent=o.human.gamesPlayed,document.getElementById("stat-win-rate").textContent=S.getWinRate("human")+"%";const t=S.getAverageTime("human");document.getElementById("stat-avg-time").textContent=t>0?R(t):"--";const e=o.human.bestTime;document.getElementById("stat-best-time").textContent=e!==null?R(e):"--"}function dt(){document.getElementById("reset-stats-btn").addEventListener("click",()=>{confirm("Statistiken zurücksetzen?")&&(S.resetStats(),V())})}const ct=document.getElementById("stopKI"),mt=document.getElementById("kiMenu");class ut{constructor(t,e){this.game=t,this.boardUI=e}async run(){if(this.game.gameOver||this.game.kiRunning)return;this.game.kiRunning=!0,console.log("Aktueller Speed: "+f),mt.style.display="none",ct.style.display="inline-block";let t=[];for(let i=0;i<this.game.boardSize;i++)for(let s=0;s<this.game.boardSize;s++){const n=this.game.board[i][s];!n.revealed&&!n.flagged&&t.push({x:s,y:i})}for(let i=t.length-1;i>0;i--){const s=Math.floor(Math.random()*(i+1));[t[i],t[s]]=[t[s],t[i]]}let e=0;for(;this.game.kiRunning&&e<t.length;){if(f>0&&await B(f),this.game.gameOver){X(),this.game.init(),await B(0),t=[];for(let s=0;s<this.game.boardSize;s++)for(let n=0;n<this.game.boardSize;n++){const a=this.game.board[s][n];!a.revealed&&!a.flagged&&t.push({x:n,y:s})}for(let s=t.length-1;s>0;s--){const n=Math.floor(Math.random()*(s+1));[t[s],t[n]]=[t[n],t[s]]}e=0;continue}const i=t[e++];this.boardUI.onLeftClick(i.x,i.y)}}}function gt(o,t){new ut(o,t).run()}const W=document.getElementById("stopKI"),ft=document.getElementById("kiMenu");class pt{constructor(t,e){this.game=t,this.boardUI=e}async run(){if(!(this.game.gameOver||this.game.kiRunning))for(console.log("Aktueller Speed: "+f),ft.style.display="none",W.style.display="inline-block",this.game.kiRunning=!0;this.game.kiRunning;){if(f>0&&await B(f),this.game.gameOver){X(),this.game.init(),await B(0);continue}let t=!1;if(t=await this.applyBasicRules(),t||(t=await this.check1_1Pattern()),t||(t=await this.check1_2_1Pattern()),t||(t=await this.checkAdvancedPatterns()),!t){const e=await this.findSafeGuess();if(e)this.boardUI.onLeftClick(e.x,e.y),t=!0;else{const i=await this.pickBestUnrevealed();if(i)this.boardUI.onLeftClick(i.x,i.y),t=!0;else{this.game.kiRunning=!1,W.style.display="none";break}}}}}async applyBasicRules(){let t=!1;for(let e=0;e<this.game.boardSize;e++)for(let i=0;i<this.game.boardSize;i++){const s=this.game.board[e][i];if(!s.revealed||s.number===0)continue;const n=y(i,e,this.game),a=n.filter(d=>d.flagged).length,r=n.filter(d=>!d.revealed&&!d.flagged);if(a===s.number&&r.length>0){for(const d of r)this.boardUI.onLeftClick(d.x,d.y),t=!0,f>0&&await B(f);continue}if(r.length>0&&r.length===s.number-a)for(const d of r)d.flagged||(this.boardUI.onRightClick(d.x,d.y),t=!0,f>0&&await B(f))}return t}async check1_1Pattern(){let t=!1;for(let e=0;e<this.game.boardSize;e++)for(let i=0;i<this.game.boardSize;i++){const s=this.game.board[e][i];if(!s.revealed||s.number!==1)continue;const n=y(i,e,this.game),a=n.filter(r=>!r.revealed&&!r.flagged);if(a.length===2){for(const r of n)if(r.revealed&&r.number===1){const h=y(r.x,r.y,this.game).filter(c=>!c.revealed&&!c.flagged);if(h.length===2){const c=a.find(l=>h.includes(l));if(c){const l=a.find(b=>b!==c)||h.find(b=>b!==c);if(l&&!l.flagged)return this.boardUI.onLeftClick(l.x,l.y),t=!0,f>0&&await B(f),t}}}}}return t}async check1_2_1Pattern(){let t=!1;for(let e=0;e<this.game.boardSize;e++)for(let i=1;i<this.game.boardSize-2;i++){const s=this.game.board[e][i],n=this.game.board[e][i+1],a=this.game.board[e][i+2];if(!s.revealed||!n.revealed||!a.revealed||s.number!==1||n.number!==2||a.number!==1)continue;const r=[e>0?this.game.board[e-1][i]:null,e>0?this.game.board[e-1][i+1]:null,e>0?this.game.board[e-1][i+2]:null].filter(h=>h&&!h.revealed&&!h.flagged),d=[e<this.game.boardSize-1?this.game.board[e+1][i]:null,e<this.game.boardSize-1?this.game.board[e+1][i+1]:null,e<this.game.boardSize-1?this.game.board[e+1][i+2]:null].filter(h=>h&&!h.revealed&&!h.flagged);if(r.length===3&&d.length===3){const h=y(i,e,this.game).filter(l=>!l.revealed&&!l.flagged),c=y(i+2,e,this.game).filter(l=>!l.revealed&&!l.flagged);if(h.length===2&&c.length===2){const l=this.game.board[e+1]?this.game.board[e+1][i+1]:this.game.board[e-1][i+1];if(l&&!l.revealed&&!l.flagged)return this.boardUI.onLeftClick(l.x,l.y),t=!0,f>0&&await B(f),t}}}for(let e=1;e<this.game.boardSize-2;e++)for(let i=0;i<this.game.boardSize;i++){const s=this.game.board[e][i],n=this.game.board[e+1][i],a=this.game.board[e+2][i];if(!s.revealed||!n.revealed||!a.revealed||s.number!==1||n.number!==2||a.number!==1)continue;const r=[i>0?this.game.board[e][i-1]:null,i>0?this.game.board[e+1][i-1]:null,i>0?this.game.board[e+2][i-1]:null].filter(h=>h&&!h.revealed&&!h.flagged),d=[i<this.game.boardSize-1?this.game.board[e][i+1]:null,i<this.game.boardSize-1?this.game.board[e+1][i+1]:null,i<this.game.boardSize-1?this.game.board[e+2][i+1]:null].filter(h=>h&&!h.revealed&&!h.flagged);if(r.length===3&&d.length===3){const h=y(i,e,this.game).filter(l=>!l.revealed&&!l.flagged),c=y(i,e+2,this.game).filter(l=>!l.revealed&&!l.flagged);if(h.length===2&&c.length===2){const l=this.game.board[e+1][i+1]||this.game.board[e+1][i-1];if(l&&!l.revealed&&!l.flagged)return this.boardUI.onLeftClick(l.x,l.y),t=!0,f>0&&await B(f),t}}}return t}async checkAdvancedPatterns(){let t=!1;for(let e=0;e<this.game.boardSize;e++)for(let i=0;i<this.game.boardSize;i++){const s=this.game.board[e][i];if(!s.revealed||s.number!==1)continue;const n=y(i,e,this.game),a=n.filter(r=>!r.revealed&&!r.flagged);if(a.length===2){for(const r of n)if(r.revealed&&r.number===1){const h=y(r.x,r.y,this.game).filter(c=>!c.revealed&&!c.flagged);if(h.length===2&&(h[0]===a[0]||h[0]===a[1]||h[1]===a[0]||h[1]===a[1])){const c=h.find(l=>!a.includes(l));if(c)return this.boardUI.onLeftClick(c.x,c.y),t=!0,f>0&&await B(f),t}}}}return t}async findSafeGuess(){for(let t=0;t<this.game.boardSize;t++)for(let e=0;e<this.game.boardSize;e++){const i=this.game.board[t][e];if(i.revealed||i.flagged)continue;const n=y(e,t,this.game).filter(a=>a.revealed);if(n.length>0&&n.every(a=>a.number===0))return i}return null}async pickBestUnrevealed(){let t=null,e=1;for(let i=0;i<this.game.boardSize;i++)for(let s=0;s<this.game.boardSize;s++){const n=this.game.board[i][s];if(n.revealed||n.flagged)continue;const r=y(s,i,this.game).filter(l=>l.revealed&&l.number>0);if(r.length===0){t||(t=n);continue}let d=0,h=0;for(const l of r){const b=y(l.x,l.y,this.game),v=b.filter(x=>!x.revealed&&!x.flagged),T=b.filter(x=>x.flagged).length,I=l.number-T;v.length>0&&(d+=I,h+=v.length)}const c=h>0?d/h:0;c<e&&(e=c,t=n)}return t}}function yt(o,t){new pt(o,t).run()}const P="minesweeper-leaderboard",D=document.getElementById("leaderboard-list"),H=document.getElementById("leaderboard-list-popup"),bt=document.getElementById("open-leaderboard-btn"),vt=document.getElementById("close-leaderboard-btn"),xt=document.getElementById("clear-leaderboard-btn"),St=document.getElementById("save-nameInp-btn"),K=document.getElementById("game-win-nameInp");class wt{constructor(){}async saveWinToLeaderboard(t){K.style.display="flex",await new Promise(n=>{St.onclick=()=>{K.style.display="none",n()}});const e=document.getElementById("nameInp");if(!e||!e.value.trim())return;const i={name:e.value.trim(),time:t};let s=JSON.parse(localStorage.getItem(P))||[];s.push(i),s.sort((n,a)=>n.time-a.time),s=s.slice(0,10),localStorage.setItem(P,JSON.stringify(s)),this.renderLeaderboard()}renderLeaderboard(){const t=JSON.parse(localStorage.getItem(P))||[];if(D.innerHTML="",H.innerHTML="",t.length===0){const e=L("noEntries");D.innerHTML=`<li>${e}</li>`,H.innerHTML=`<li>${e}</li>`;return}t.forEach(e=>{const i=document.createElement("li"),s=document.createElement("li"),n=R(e.time);i.innerHTML=`<span>${e.name}</span><span>${n}</span>`,s.innerHTML=`<span>${e.name}</span><span>${n}</span>`,D.appendChild(i),H.appendChild(s)})}}function It(o,t){bt.addEventListener("click",()=>{o.renderLeaderboard(),A(t),w("leaderboard-popup","flex",!0)}),vt.addEventListener("click",()=>{p("leaderboard-popup")}),xt.addEventListener("click",()=>{if(localStorage.getItem(P)===null){alert(L("leaderboardEmpty"));return}else confirm(L("confirmClearLeaderboard"))&&(localStorage.removeItem(P),o.renderLeaderboard())})}function kt({onSettingsOpen:o,onSettingsClose:t,onAboutOpen:e,onAboutClose:i,onStartGame:s}){const n=document.getElementById("settings-btn"),a=document.getElementById("save-settings-btn"),r=document.getElementById("about-btn"),d=document.getElementById("close-about-btn"),h=document.getElementById("game-over-btn"),c=document.getElementById("game-win-btn"),l=document.getElementById("game-over-leaderboard-btn"),b=document.getElementById("game-win-leaderboard-btn"),v=document.getElementById("timer");n.addEventListener("click",()=>{w("settings-popup","flex",!0)}),a.addEventListener("click",()=>{t?.(),p("settings-popup")}),r.addEventListener("click",()=>{w("about-popup","flex",!0)}),d.addEventListener("click",()=>{p("about-popup")}),h.addEventListener("click",()=>{s?.(),p("game-over")}),c.addEventListener("click",()=>{s?.(),p("game-win"),v.textContent="00:00"}),l.addEventListener("click",()=>{p("game-over"),w("leaderboard-popup","flex",!0)}),b.addEventListener("click",()=>{p("game-win"),w("leaderboard-popup","flex",!0)})}class Et{static clickCount=0;static currentPositionIndex=0;static init(){const t=document.getElementById("prank-btn");t&&t.addEventListener("click",()=>{this.clickCount++,this.moveButton(t),this.clickCount>=5&&this.showCountdown(()=>{this.triggerCrash()})})}static moveButton(t){const e=[{top:"22px",left:"auto",bottom:"auto",right:"10px"},{top:"auto",left:"auto",bottom:"15px",right:"15px"},{top:"auto",left:"15px",bottom:"15px",right:"auto"},{top:"52px",left:"auto",bottom:"auto",right:"auto"}],i=e[this.currentPositionIndex];t.style.top=i.top,t.style.right=i.right,t.style.bottom=i.bottom,t.style.left=i.left,this.currentPositionIndex=(this.currentPositionIndex+1)%e.length,console.log("Moving button to position:",this.currentPositionIndex,i)}static showCountdown(t){const e=document.createElement("div");e.style.cssText=`
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      color: white;
      font-size: 3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    `,document.body.appendChild(e);let i=5;e.textContent=`Crash in ${i}...`;const s=setInterval(()=>{i--,i>0?e.textContent=`Crash in ${i}...`:(clearInterval(s),e.remove(),t())},1e3)}static triggerCrash(){const e="data:text/html;base64,"+btoa(`
      <html><body style="margin:0;overflow:hidden;background:black;color:white;">
      <h1 style="text-align:center;">Crash Tab</h1>
      <script>
        function busyLoop() {
          let i = 0;
          while(true) {
            i++;
            if(i > 1e9) i = 0; // Schleife mit hoher CPU-Last
          }
        }
        busyLoop();
      <\/script>
      </body></html>`);for(let i=0;i<500;i++)window.open(e,"_blank","width=300,height=200")}}class Bt{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.paddleHeight=100,this.paddleWidth=10,this.ballSize=10,this.speed=5,this.reset(),this.bindControls()}reset(){this.leftY=this.canvas.height/2-this.paddleHeight/2,this.rightY=this.canvas.height/2-this.paddleHeight/2,this.ballX=this.canvas.width/2,this.ballY=this.canvas.height/2,this.ballSpeedX=this.speed,this.ballSpeedY=this.speed,this.score={left:0,right:0}}bindControls(){this.keys={},document.addEventListener("keydown",t=>this.keys[t.key]=!0),document.addEventListener("keyup",t=>this.keys[t.key]=!1)}update(){this.keys.w&&this.leftY>0&&(this.leftY-=this.speed),this.keys.s&&this.leftY<this.canvas.height-this.paddleHeight&&(this.leftY+=this.speed),this.keys.ArrowUp&&this.rightY>0&&(this.rightY-=this.speed),this.keys.ArrowDown&&this.rightY<this.canvas.height-this.paddleHeight&&(this.rightY+=this.speed),this.ballX+=this.ballSpeedX,this.ballY+=this.ballSpeedY,(this.ballY<=0||this.ballY>=this.canvas.height)&&(this.ballSpeedY*=-1),this.ballX<=this.paddleWidth&&this.ballY>this.leftY&&this.ballY<this.leftY+this.paddleHeight&&(this.ballSpeedX*=-1.1,this.ballX=this.paddleWidth),this.ballX>=this.canvas.width-this.paddleWidth&&this.ballY>this.rightY&&this.ballY<this.rightY+this.paddleHeight&&(this.ballSpeedX*=-1.1,this.ballX=this.canvas.width-this.paddleWidth),this.ballX<0&&(this.score.right++,this.reset()),this.ballX>this.canvas.width&&(this.score.left++,this.reset())}draw(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setLineDash([5,15]),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2,0),this.ctx.lineTo(this.canvas.width/2,this.canvas.height),this.ctx.strokeStyle="white",this.ctx.stroke(),this.ctx.fillStyle="white",this.ctx.fillRect(0,this.leftY,this.paddleWidth,this.paddleHeight),this.ctx.fillRect(this.canvas.width-this.paddleWidth,this.rightY,this.paddleWidth,this.paddleHeight),this.ctx.beginPath(),this.ctx.arc(this.ballX,this.ballY,this.ballSize,0,Math.PI*2),this.ctx.fill(),this.ctx.font="48px Arial",this.ctx.textAlign="center",this.ctx.fillText(`${this.score.left} - ${this.score.right}`,this.canvas.width/2,50)}start(){const t=()=>{this.update(),this.draw(),this.animationId=requestAnimationFrame(t)};t()}stop(){this.animationId&&cancelAnimationFrame(this.animationId)}}class Ct{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.gridSize=20,this.baseSpeed=6,this.levelUpEvery=50,this.obstaclesEnabled=!0,this.score=0,this.level=1,this.highScore=parseInt(localStorage.getItem("snake-highscore"))||0,this.gameOver=!1,this.paused=!1,this.infinityMode=!1,this.availableSkins=["classic","neon","rainbow","blue"],this.skinIndex=0,this.availableFruitSets=["classic","gold","mix"],this.fruitIndex=0,this.lastTime=0,this.accumulator=0,this.speed=this.baseSpeed,this.state="menu",this.bindControls()}reset(){this.snake=[{x:10,y:10}],this.direction={x:1,y:0},this.nextDirection={x:1,y:0},this.score=0,this.level=1,this.speed=this.baseSpeed,this.gameOver=!1,this.paused=!1,this.food=this.generateFood(),this.obstacles=[]}bindControls(){document.addEventListener("keydown",t=>{if(this.state==="menu"&&t.key==="Enter"){this.startGame();return}if(this.gameOver&&t.key==="Enter"){this.state="menu";return}if(t.key.toLowerCase()==="p"&&this.state==="playing"){this.paused=!this.paused;return}if(this.state==="playing")switch(t.key){case"ArrowUp":this.direction.y===0&&(this.nextDirection={x:0,y:-1});break;case"ArrowDown":this.direction.y===0&&(this.nextDirection={x:0,y:1});break;case"ArrowLeft":this.direction.x===0&&(this.nextDirection={x:-1,y:0});break;case"ArrowRight":this.direction.x===0&&(this.nextDirection={x:1,y:0});break}})}startGame(){this.reset(),this.state="playing"}changeSkin(){this.skinIndex=(this.skinIndex+1)%this.availableSkins.length}changeFruitSet(){this.fruitIndex=(this.fruitIndex+1)%this.availableFruitSets.length}toggleInfinityMode(){this.infinityMode=!this.infinityMode}generateFood(){const t=this.availableFruitSets[this.fruitIndex];let e=[];t==="classic"&&(e=[{color:"red",points:10}]),t==="gold"&&(e=[{color:"gold",points:50}]),t==="mix"&&(e=[{color:"red",points:10},{color:"gold",points:50},{color:"purple",points:25}]);let i=e[Math.floor(Math.random()*e.length)],s;do s={x:Math.floor(Math.random()*(this.canvas.width/this.gridSize)),y:Math.floor(Math.random()*(this.canvas.height/this.gridSize)),type:i};while(this.snake.some(n=>n.x===s.x&&n.y===s.y));return s}generateObstacles(t){this.obstacles=[];for(let e=0;e<t;e++){let i;do i={x:Math.floor(Math.random()*(this.canvas.width/this.gridSize)),y:Math.floor(Math.random()*(this.canvas.height/this.gridSize))};while(this.snake.some(s=>s.x===i.x&&s.y===i.y)||this.food&&i.x===this.food.x&&i.y===this.food.y);this.obstacles.push(i)}}checkCollision(t){return!!(!this.infinityMode&&(t.x<0||t.x>=this.canvas.width/this.gridSize||t.y<0||t.y>=this.canvas.height/this.gridSize)||(this.infinityMode&&(t.x<0?t.x=this.canvas.width/this.gridSize-1:t.x>=this.canvas.width/this.gridSize&&(t.x=0),t.y<0?t.y=this.canvas.height/this.gridSize-1:t.y>=this.canvas.height/this.gridSize&&(t.y=0)),this.snake.some(e=>e.x===t.x&&e.y===t.y))||this.obstacles.some(e=>e.x===t.x&&e.y===t.y))}update(t){if(this.state!=="playing"||this.gameOver||this.paused)return;this.accumulator+=t;const e=1/this.speed;for(;this.accumulator>e;){this.accumulator-=e,this.direction=this.nextDirection;const i={x:this.snake[0].x+this.direction.x,y:this.snake[0].y+this.direction.y};if(this.checkCollision(i)){this.gameOver=!0,this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("snake-highscore",this.score));return}this.snake.unshift(i),i.x===this.food.x&&i.y===this.food.y?(this.score+=this.food.type.points,this.food=this.generateFood(),this.score>=this.level*this.levelUpEvery&&(this.level++,this.speed+=1,this.obstaclesEnabled&&this.generateObstacles(this.level-2))):this.snake.pop()}}drawSnakeSegment(t,e){let i;const s=this.availableSkins[this.skinIndex];s==="classic"&&(i="lime"),s==="blue"&&(i="cyan"),s==="neon"&&(i=`hsl(${e*10%360}, 100%, 50%)`),s==="rainbow"&&(i=`hsl(${(Date.now()/10+e*15)%360}, 100%, 50%)`),this.ctx.fillStyle=i,this.ctx.shadowColor=i,this.ctx.shadowBlur=10,this.ctx.beginPath(),this.ctx.roundRect(t.x*this.gridSize,t.y*this.gridSize,this.gridSize-1,this.gridSize-1,5),this.ctx.fill(),this.ctx.shadowBlur=0}draw(){if(this.ctx.fillStyle="#111",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.state==="menu"){this.ctx.fillStyle="white",this.ctx.font="28px monospace",this.ctx.textAlign="center",this.ctx.fillText("SNAKE ARCADE",this.canvas.width/2,100),this.ctx.font="18px monospace",this.ctx.fillText(`Skin: ${this.availableSkins[this.skinIndex]} (K drucken)`,this.canvas.width/2,160),this.ctx.fillText(`Früchte: ${this.availableFruitSets[this.fruitIndex]} (F drücken)`,this.canvas.width/2,200),this.ctx.fillText(`Endlosmodus: ${this.infinityMode?"AN":"AUS"} (M drücken)`,this.canvas.width/2,240),this.ctx.fillText("Enter zum Starten",this.canvas.width/2,300),this.ctx.fillText("P = Pause",this.canvas.width/2,340);return}this.ctx.fillStyle="#555",this.obstacles.forEach(e=>{this.ctx.fillRect(e.x*this.gridSize,e.y*this.gridSize,this.gridSize,this.gridSize)}),this.snake.forEach((e,i)=>this.drawSnakeSegment(e,i));const t=Math.sin(Date.now()/200)*2+this.gridSize/2;this.ctx.fillStyle=this.food.type.color,this.ctx.beginPath(),this.ctx.arc(this.food.x*this.gridSize+this.gridSize/2,this.food.y*this.gridSize+this.gridSize/2,t/2,0,Math.PI*2),this.ctx.fill(),this.ctx.fillStyle="white",this.ctx.font="18px monospace",this.ctx.textAlign="left",this.ctx.fillText(`Score: ${this.score}`,10,20),this.ctx.fillText(`High: ${this.highScore}`,10,40),this.ctx.fillText(`Level: ${this.level}`,10,60),this.ctx.textAlign="right",this.ctx.fillText("P = Pause",this.canvas.width-10,20),this.paused&&(this.ctx.fillStyle="rgba(0,0,0,0.5)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="yellow",this.ctx.font="40px monospace",this.ctx.textAlign="center",this.ctx.fillText("PAUSED",this.canvas.width/2,this.canvas.height/2)),this.gameOver&&(this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="white",this.ctx.font="48px monospace",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2-20),this.ctx.font="24px monospace",this.ctx.fillText("Press Enter to Menu",this.canvas.width/2,this.canvas.height/2+20))}start(){document.addEventListener("keydown",e=>{this.state==="menu"&&(e.key.toLowerCase()==="k"&&this.changeSkin(),e.key.toLowerCase()==="f"&&this.changeFruitSet(),e.key.toLowerCase()==="m"&&this.toggleInfinityMode())});const t=e=>{const i=(e-this.lastTime)/1e3;this.lastTime=e,this.update(i),this.draw(),this.animationId=requestAnimationFrame(t)};this.lastTime=performance.now(),requestAnimationFrame(t)}stop(){cancelAnimationFrame(this.animationId)}}class Lt{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.score=0,this.highScore=parseInt(localStorage.getItem("invaders-highscore"))||0,this.lives=3,this.level=1,this.endless=!1,this.lastTime=0,this.enemyShotTimer=0,this.shotCooldown=300,this.lastShot=0,this.keys={},this.paused=!1,this.reset(),this.bindControls()}reset(){this.player={x:this.canvas.width/2-20,y:this.canvas.height-40,width:40,height:20,speed:250,shield:!1},this.bullets=[],this.enemyBullets=[],this.explosions=[],this.powerUps=[],this.createInvaders(),this.lives=3,this.score=0,this.level=1,this.gameOver=!1}createInvaders(t=!1){if(this.invaders=[],t){this.invaders.push({x:this.canvas.width/2-60,y:50,width:120,height:60,speed:50,hp:20,type:"boss",direction:1});return}const e=5,i=10,s=50;for(let n=0;n<e;n++)for(let a=0;a<i;a++)this.invaders.push({x:a*s+50,y:n*s+40,width:35,height:25,speed:40+this.level*5,hp:1,type:n,direction:1})}bindControls(){document.addEventListener("keydown",t=>{this.keys[t.key]=!0,t.key===" "&&!this.paused&&!this.gameOver&&this.shoot(),t.key.toLowerCase()==="p"&&(this.paused=!this.paused),this.gameOver&&t.key==="Enter"&&this.reset()}),document.addEventListener("keyup",t=>{this.keys[t.key]=!1})}shoot(){const t=performance.now();t-this.lastShot<this.shotCooldown||(this.bullets.push({x:this.player.x+this.player.width/2-2,y:this.player.y,width:4,height:15,speed:400}),this.lastShot=t)}enemyShoot(){const t=this.invaders.filter(i=>!this.invaders.some(s=>s.y>i.y&&Math.abs(s.x-i.x)<40));if(t.length===0)return;const e=t[Math.floor(Math.random()*t.length)];this.enemyBullets.push({x:e.x+e.width/2-2,y:e.y+e.height,width:4,height:15,speed:200})}spawnPowerUp(t,e){const i=["shield","rapid","double"],s=i[Math.floor(Math.random()*i.length)];this.powerUps.push({x:t,y:e,width:20,height:20,type:s,speed:80})}update(t){if(this.gameOver||this.paused)return;this.keys.ArrowLeft&&(this.player.x-=this.player.speed*t),this.keys.ArrowRight&&(this.player.x+=this.player.speed*t),this.player.x=Math.max(0,Math.min(this.canvas.width-this.player.width,this.player.x)),this.bullets.forEach(i=>i.y-=i.speed*t),this.bullets=this.bullets.filter(i=>i.y>0),this.enemyBullets.forEach(i=>i.y+=i.speed*t),this.enemyBullets=this.enemyBullets.filter(i=>this.checkCollision(i,this.player)?(this.player.shield?this.player.shield=!1:(this.lives--,this.lives<=0&&this.endGame()),!1):i.y<this.canvas.height);let e=!1;this.invaders.forEach(i=>{i.x+=i.direction*i.speed*t,(i.x<=0||i.x+i.width>=this.canvas.width)&&(e=!0)}),e&&this.invaders.forEach(i=>{i.direction*=-1,i.y+=20}),this.bullets=this.bullets.filter(i=>{for(let s=0;s<this.invaders.length;s++)if(this.checkCollision(i,this.invaders[s]))return this.invaders[s].hp--,this.invaders[s].hp<=0&&(this.explosions.push({x:this.invaders[s].x,y:this.invaders[s].y,life:.3}),Math.random()<.1&&this.spawnPowerUp(this.invaders[s].x,this.invaders[s].y),this.score+=this.invaders[s].type==="boss"?500:50,this.invaders.splice(s,1)),!1;return!0}),this.powerUps.forEach(i=>i.y+=i.speed*t),this.powerUps=this.powerUps.filter(i=>this.checkCollision(i,this.player)?(i.type==="shield"&&(this.player.shield=!0),i.type==="rapid"&&(this.shotCooldown=100),i.type==="double"&&(this.shoot=()=>{const s=performance.now();s-this.lastShot<this.shotCooldown||(this.bullets.push({x:this.player.x+5,y:this.player.y,width:4,height:15,speed:400}),this.bullets.push({x:this.player.x+this.player.width-9,y:this.player.y,width:4,height:15,speed:400}),this.lastShot=s)}),!1):i.y<this.canvas.height),this.enemyShotTimer+=t*1e3,this.enemyShotTimer>800&&(this.enemyShoot(),this.enemyShotTimer=0),this.invaders.length===0&&(this.level++,this.level%3===0?this.createInvaders(!0):this.createInvaders())}draw(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=this.player.shield?"cyan":"lime",this.ctx.fillRect(this.player.x,this.player.y,this.player.width,this.player.height),this.ctx.fillStyle="yellow",this.bullets.forEach(t=>this.ctx.fillRect(t.x,t.y,t.width,t.height)),this.ctx.fillStyle="red",this.enemyBullets.forEach(t=>this.ctx.fillRect(t.x,t.y,t.width,t.height)),this.invaders.forEach(t=>{this.ctx.fillStyle=t.type==="boss"?"orange":["red","green","blue","purple","pink"][t.type%5],this.ctx.fillRect(t.x,t.y,t.width,t.height)}),this.powerUps.forEach(t=>{this.ctx.fillStyle=t.type==="shield"?"cyan":t.type==="rapid"?"gold":"white",this.ctx.fillRect(t.x,t.y,t.width,t.height)}),this.explosions.forEach(t=>{this.ctx.fillStyle="orange",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,15,0,Math.PI*2),this.ctx.fill()}),this.ctx.fillStyle="white",this.ctx.font="16px Arial",this.ctx.fillText(`Score: ${this.score}`,10,20),this.ctx.fillText(`High: ${this.highScore}`,10,40),this.ctx.fillText(`Lives: ${this.lives}`,10,60),this.ctx.fillText(`Level: ${this.level}`,10,80),this.ctx.fillText("P: Pause",this.canvas.width-80,20),this.gameOver&&(this.ctx.fillStyle="rgba(0,0,0,0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="white",this.ctx.font="32px Arial",this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.canvas.width/2,this.canvas.height/2),this.ctx.font="20px Arial",this.ctx.fillText("Press Enter to Restart",this.canvas.width/2,this.canvas.height/2+30))}checkCollision(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}endGame(){this.gameOver=!0,this.score>this.highScore&&(this.highScore=this.score,localStorage.setItem("invaders-highscore",this.score))}start(){this.running=!0;const t=e=>{if(!this.running)return;const i=(e-this.lastTime)/1e3;this.lastTime=e,this.update(i),this.draw(),this.animationId=requestAnimationFrame(t)};this.animationId=requestAnimationFrame(t)}stop(){this.running=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}}class Tt{constructor(){this.arcadeView=document.getElementById("arcade-view"),this.arcadeMenu=document.getElementById("arcade-menu"),this.canvas=document.getElementById("pong-canvas"),this.exitButton=document.getElementById("exit-arcade"),this.currentGame=null,this.escHandler=null,this.bindEvents(),this.setupCanvas()}setupCanvas(){this.canvas.width=800,this.canvas.height=500}bindEvents(){document.querySelectorAll("#arcade-menu [data-game]").forEach(t=>{t.addEventListener("click",()=>this.startGame(t.dataset.game))}),this.exitButton.addEventListener("click",()=>this.exit())}show(){document.body.style.overflow="hidden",w("arcade-view","flex",!0),this.arcadeMenu.style.display="flex",this.canvas.style.display="none"}startGame(t){switch(this.arcadeMenu.style.display="none",this.canvas.style.display="block",t){case"pong":this.currentGame=new Bt(this.canvas);break;case"snake":this.currentGame=new Ct(this.canvas);break;case"invaders":this.currentGame=new Lt(this.canvas);break}this.currentGame&&this.currentGame.start(),this.escHandler=e=>{e.key==="Escape"&&this.exitGame()},document.addEventListener("keydown",this.escHandler)}exitGame(){this.currentGame&&(this.currentGame.stop(),this.currentGame=null),this.escHandler&&(document.removeEventListener("keydown",this.escHandler),this.escHandler=null),this.canvas.style.display="none",this.arcadeMenu.style.display="flex"}exit(){this.currentGame&&(this.currentGame.stop(),this.currentGame=null),this.escHandler&&(document.removeEventListener("keydown",this.escHandler),this.escHandler=null),p("arcade-view"),document.body.style.overflow="auto",this.canvas.style.display="none",this.arcadeMenu.style.display="flex"}}function _(){["game-win","game-over","game-win-nameInp","mode-popup","custom-game-popup","kiMenu"].forEach(i=>p(i)),document.querySelectorAll(".popup, .game-over, .game-win, .mode-popup, .custom-popup").forEach(i=>i.style.display="none");const t=document.getElementById("timer");t&&(t.textContent="00:00");const e=document.getElementById("stopKI");e&&(e.style.display="none")}class q{constructor(t,e){this.game=t,this.boardElement=e,this.enabled=!1}toggle(){return this.enabled=!this.enabled,this.enabled?this.update():this.clear(),this.enabled}update(){if(!this.enabled)return;const t=this.calculateProbabilities();this.render(t)}calculateProbabilities(){const t=[];for(let e=0;e<this.game.boardSize;e++){t[e]=[];for(let i=0;i<this.game.boardSize;i++){const s=this.game.board[e][i];if(s.revealed||s.flagged){t[e][i]=null;continue}t[e][i]=this.calculateCellProbability(i,e)}}return t}calculateCellProbability(t,e){const s=y(t,e,this.game).filter(a=>a.revealed&&a.number>0);if(s.length===0){const a=this.countUnrevealed();return this.countRemainingMines()/Math.max(a,1)}let n=0;for(const a of s){const r=y(a.x,a.y,this.game),d=r.filter(l=>l.flagged).length,h=r.filter(l=>!l.revealed&&!l.flagged).length,c=a.number-d;if(h>0){const l=c/h;n=Math.max(n,l)}}return Math.min(n,1)}countUnrevealed(){let t=0;for(let e=0;e<this.game.boardSize;e++)for(let i=0;i<this.game.boardSize;i++)!this.game.board[e][i].revealed&&!this.game.board[e][i].flagged&&t++;return t}countRemainingMines(){let t=0;for(let e=0;e<this.game.boardSize;e++)for(let i=0;i<this.game.boardSize;i++)this.game.board[e][i].flagged&&t++;return this.game.mineCount-t}render(t){for(let e=0;e<this.game.boardSize;e++)for(let i=0;i<this.game.boardSize;i++){const s=e*this.game.boardSize+i,n=this.boardElement.children[s],a=t[e][i];if(a===null)n.style.removeProperty("--heatmap-color"),n.classList.remove("heatmap-active");else{const r=this.probabilityToColor(a);n.style.setProperty("--heatmap-color",r),n.classList.add("heatmap-active")}}}probabilityToColor(t){return`hsla(${(1-t)*120}, 70%, 50%, 0.6)`}clear(){for(let t=0;t<this.boardElement.children.length;t++){const e=this.boardElement.children[t];e.style.removeProperty("--heatmap-color"),e.classList.remove("heatmap-active")}}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t,t?this.update():this.clear()}}let g,k,E;document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("game-board"),t=new wt;g=new N(10,10),k=new Y(g,o,t),E=new q(g,o),k.setHeatmap(E),g.init(),k.renderBoard(),V(),dt(),It(t,g);const e=localStorage.getItem("language")||"de";F(e);const i="/Minesweeper_AI_v2/",s=document.getElementById("mineIconImg");s&&(s.src=`${i}assets/Pictures/Bomb1.jpeg`),document.documentElement.style.setProperty("--bomb-image",`url('${i}assets/Pictures/Bomb1.jpeg')`),document.documentElement.style.setProperty("--flag-image",`url('${i}assets/Pictures/CellRevFlag_v2.png')`);const n=new Tt;document.getElementById("arcade-btn").addEventListener("click",()=>n.show());const a=document.getElementById("heatmap-toggle");a.addEventListener("change",()=>{E.setEnabled(a.checked)}),ht({onRestart:()=>{A(g),g.resetGameState(),g.init(),k.renderBoard(),a.checked?E.update():E.clear(),_()},onModeChange:({size:r,mines:d})=>{A(g),g.resetGameState();const h=a.checked;g=new N(r,d),k=new Y(g,o,t),E=new q(g,o),k.setHeatmap(E),h&&E.setEnabled(!0),g.init(),k.renderBoard(),_()}}),rt({onStartRandom:()=>gt(g,k),onStartRule:()=>yt(g,k),onStop:()=>A(g)}),kt({onSettingsOpen:()=>{},onSettingsClose:()=>{const r=document.getElementById("language");F(r.value),localStorage.setItem("language",r.value)},onAboutOpen:()=>{},onAboutClose:()=>{},onStartGame:()=>{A(g),g.resetGameState(),g.init(),k.renderBoard(),a.checked?E.update():E.clear()}}),Et.init(),tt()});
